this is admin dashboard.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | FastSewa</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="admindashboard.css">
</head>

<body>

    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fas fa-shield-alt"></i>
            FastSewa<span>Admin</span>
        </div>

        <div class="admin-panel">
            <div class="admin-avatar" id="adminAvatar">A</div>
            <div class="admin-name" id="adminName">Admin User</div>
            <div class="admin-badge">ADMINISTRATOR</div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item active" onclick="showSection('dashboard', this)">
                <i class="fas fa-th-large"></i> Dashboard
            </div>
            <div class="nav-item" onclick="showSection('bookings', this)">
                <i class="fas fa-calendar-check"></i> All Bookings
            </div>
            <div class="nav-item" onclick="showSection('users', this)">
                <i class="fas fa-users"></i> Customers
            </div>
            <div class="nav-item" onclick="showSection('admins', this)">
                <i class="fas fa-user-shield"></i> Admins
            </div>
        </nav>

        <div class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </div>
    </aside>

    <main class="main-content">
        <header class="top-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-bars mobile-toggle" onclick="toggleSidebar()"></i>
                <div class="header-title">Dashboard Overview</div>
            </div>

            <div class="header-actions">
                <span style="color: var(--text-muted); font-size: 0.9rem;">
                    <i class="far fa-clock"></i> <span id="currentTime"></span>
                </span>
            </div>
        </header>

        <div class="content-scroll">

            <!-- DASHBOARD SECTION -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h2 id="totalCustomers">0</h2>
                            <p>Total Customers</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="stat-content">
                            <h2 id="totalAdmins">0</h2>
                            <p>Admin Users</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h2 id="totalBookings">0</h2>
                            <p>Total Bookings</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h2 id="pendingBookings">0</h2>
                            <p>Pending Requests</p>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h2>Recent Bookings</h2>
                        <button class="btn btn-primary" onclick="showSection('bookings')">View All</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Customer</th>
                                <th>Service</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentBookingsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- BOOKINGS SECTION -->
            <div id="bookings" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>All Service Bookings</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Customer Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Service</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="allBookingsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- USERS SECTION -->
            <div id="users" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Customer Management</h2>
                        <button class="btn btn-primary" onclick="openAddUserModal()">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Joined</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- ADMINS SECTION -->
            <div id="admins" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Admin Management</h2>
                        <button class="btn btn-primary" onclick="openAddAdminModal()">
                            <i class="fas fa-user-plus"></i> Add Admin
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Added On</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="adminsTable"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Customer</h2>
                <span class="close-modal" onclick="closeModal('addUserModal')">&times;</span>
            </div>
            <form id="addUserForm">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" class="form-input" id="userFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" class="form-input" id="userLastName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="userPassword" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" class="form-input" id="userPhone">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Add Customer</button>
            </form>
        </div>
    </div>

    <!-- Add Admin Modal -->
    <div class="modal" id="addAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Admin</h2>
                <span class="close-modal" onclick="closeModal('addAdminModal')">&times;</span>
            </div>
            <form id="addAdminForm">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" class="form-input" id="adminFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" class="form-input" id="adminLastName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="adminEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="adminPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Add Admin</button>
            </form>
        </div>
    </div>

    <script src="admin.js"></script>
</body>

</html>

admin.js -->
const API = "http://localhost:5000/api";
// const API = "https://fastsewawebsite.onrender.com/api";

// Get token from localStorage
function getToken() {
    return localStorage.getItem("fastsewa_token");
}

// Auth headers for API requests
function authHeaders() {
    return {
        "Authorization": "Bearer " + getToken(),
        "Content-Type": "application/json"
    };
}

// Category labels mapping
const CATEGORY_LABELS = {
    construction: "Construction",
    land: "Land Services",
    finance: "Finance",
    legal: "Legal",
    medical: "Medical",
    gst: "GST",
    incometax: "Income Tax",
    material: "Material Supply",
    repair: "Repair Service",
    security: "Security",
    trademark: "Trademark"
};

// Status labels mapping
const STATUS_LABELS = {
    pending: "Request Received",
    verified: "Verified",
    assigned: "Professional Assigned",
    completed: "Completed",
    cancelled: "Cancelled"
};

// ========================================
// INITIALIZATION
// ========================================
document.addEventListener("DOMContentLoaded", async () => {
    // Check if user is logged in and is admin
    await checkAdminAuth();

    // Load all data
    loadDashboardStats();
    updateTime();
    setInterval(updateTime, 1000);
});

// ========================================
// AUTH CHECK
// ========================================
async function checkAdminAuth() {
    const token = localStorage.getItem("fastsewa_token");
    const user = JSON.parse(localStorage.getItem("fastsewa_current_user"));

    if (!token || !user) {
        window.location.href = "/login.html";
        return;
    }

    // Check if user is admin
    if (user.userType !== "admin") {
        alert("Access Denied: Admin privileges required");
        localStorage.removeItem("fastsewa_token");
        localStorage.removeItem("fastsewa_current_user");
        window.location.href = "/login.html";
        return;
    }

    // Populate admin info
    const firstName = user.firstName || "Admin";
    document.getElementById("adminName").innerText = user.fullName || "Admin User";
    document.getElementById("adminAvatar").innerText = firstName.charAt(0);
}

// ========================================
// DASHBOARD STATS
// ========================================
async function loadDashboardStats() {
    try {
        const [users, bookings] = await Promise.all([
            fetch(API + "/admin/users", { headers: authHeaders() }).then(r => r.json()),
            fetch(API + "/admin/bookings", { headers: authHeaders() }).then(r => r.json())
        ]);

        // Calculate stats
        const customers = users.filter(u => u.userType === "customer");
        const admins = users.filter(u => u.userType === "admin");
        const pending = bookings.filter(b => b.status === "pending");

        // Update dashboard stats
        document.getElementById("totalCustomers").innerText = customers.length;
        document.getElementById("totalAdmins").innerText = admins.length;
        document.getElementById("totalBookings").innerText = bookings.length;
        document.getElementById("pendingBookings").innerText = pending.length;

        // Load recent bookings (last 5)
        loadRecentBookings(bookings.slice(0, 5));

    } catch (err) {
        console.error("Failed to load dashboard stats:", err);
        showToast("Failed to load dashboard data", "error");
    }
}

// ========================================
// BOOKINGS MANAGEMENT
// ========================================
async function loadBookings() {
    try {
        const bookings = await fetch(API + "/admin/bookings", {
            headers: authHeaders()
        }).then(r => r.json());

        const table = document.getElementById("allBookingsTable");
        table.innerHTML = "";

        if (bookings.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="8" class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No bookings found</p>
                    </td>
                </tr>`;
            return;
        }

        bookings.forEach(b => {
            table.innerHTML += `
                <tr>
                    <td><strong>FS-${b._id.slice(-6).toUpperCase()}</strong></td>
                    <td>${b.fullName || "N/A"}</td>
                    <td>${b.email || "N/A"}</td>
                    <td>${b.phone || "N/A"}</td>
                    <td>${CATEGORY_LABELS[b.category] || b.category}</td>
                    <td>${new Date(b.date).toLocaleDateString()}</td>
                    <td>
                        <select class="status-select" onchange="updateStatus('${b._id}', this.value)">
                            ${["pending", "verified", "assigned", "completed", "cancelled"].map(s => `
                                <option value="${s}" ${b.status === s ? "selected" : ""}>
                                    ${STATUS_LABELS[s]}
                                </option>
                            `).join("")}
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteBooking('${b._id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
        });

    } catch (err) {
        console.error("Failed to load bookings:", err);
        showToast("Failed to load bookings", "error");
    }
}

function loadRecentBookings(bookings) {
    const table = document.getElementById("recentBookingsTable");
    table.innerHTML = "";

    if (bookings.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="5" class="empty-state">No recent bookings</td>
            </tr>`;
        return;
    }

    bookings.forEach(b => {
        table.innerHTML += `
            <tr>
                <td><strong>FS-${b._id.slice(-6).toUpperCase()}</strong></td>
                <td>${b.fullName || "N/A"}</td>
                <td>${CATEGORY_LABELS[b.category] || b.category}</td>
                <td>${new Date(b.date).toLocaleDateString()}</td>
                <td>
                    <span class="status-badge status-${b.status}">
                        ${STATUS_LABELS[b.status]}
                    </span>
                </td>
            </tr>`;
    });
}

async function updateStatus(bookingId, newStatus) {
    try {
        await fetch(API + "/admin/bookings/" + bookingId, {
            method: "PUT",
            headers: authHeaders(),
            body: JSON.stringify({ status: newStatus })
        });

        showToast("Status updated successfully", "success");
        loadBookings();
        loadDashboardStats();

    } catch (err) {
        console.error("Failed to update status:", err);
        showToast("Failed to update status", "error");
    }
}

async function deleteBooking(bookingId) {
    if (!confirm("Are you sure you want to delete this booking?")) return;

    try {
        await fetch(API + "/admin/bookings/" + bookingId, {
            method: "DELETE",
            headers: authHeaders()
        });

        showToast("Booking deleted successfully", "success");
        loadBookings();
        loadDashboardStats();

    } catch (err) {
        console.error("Failed to delete booking:", err);
        showToast("Failed to delete booking", "error");
    }
}

// ========================================
// USERS MANAGEMENT
// ========================================
async function loadUsers() {
    try {
        const users = await fetch(API + "/admin/users", {
            headers: authHeaders()
        }).then(r => r.json());

        const customers = users.filter(u => u.userType === "customer");
        const table = document.getElementById("usersTable");
        table.innerHTML = "";

        if (customers.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="5" class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>No customers found</p>
                    </td>
                </tr>`;
            return;
        }

        customers.forEach(u => {
            table.innerHTML += `
                <tr>
                    <td>${u.fullName || u.firstName + " " + u.lastName}</td>
                    <td>${u.email}</td>
                    <td>${u.phone || "N/A"}</td>
                    <td>${new Date(u.date).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteUser('${u._id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>`;
        });

    } catch (err) {
        console.error("Failed to load users:", err);
        showToast("Failed to load users", "error");
    }
}

async function deleteUser(userId) {
    if (!confirm("Are you sure you want to delete this user?")) return;

    try {
        await fetch(API + "/admin/users/" + userId, {
            method: "DELETE",
            headers: authHeaders()
        });

        showToast("User deleted successfully", "success");
        loadUsers();
        loadDashboardStats();

    } catch (err) {
        console.error("Failed to delete user:", err);
        showToast("Failed to delete user", "error");
    }
}

// ========================================
// ADMINS MANAGEMENT
// ========================================
async function loadAdmins() {
    try {
        const users = await fetch(API + "/admin/users", {
            headers: authHeaders()
        }).then(r => r.json());

        const admins = users.filter(u => u.userType === "admin");
        const table = document.getElementById("adminsTable");
        table.innerHTML = "";

        if (admins.length === 0) {
            table.innerHTML = `
                <tr>
                    <td colspan="5" class="empty-state">No admins found</td>
                </tr>`;
            return;
        }

        admins.forEach(u => {
            const currentUser = JSON.parse(localStorage.getItem("fastsewa_current_user"));
            const isSelf = u._id === currentUser.id;

            table.innerHTML += `
                <tr>
                    <td>${u.fullName || u.firstName + " " + u.lastName}</td>
                    <td>${u.email}</td>
                    <td><span class="admin-badge">ADMIN</span></td>
                    <td>${new Date(u.date).toLocaleDateString()}</td>
                    <td>
                        ${!isSelf ? `
                            <button class="btn btn-danger" onclick="deleteUser('${u._id}')">
                                <i class="fas fa-user-minus"></i> Remove
                            </button>
                        ` : `<span style="color: var(--text-muted);">You</span>`}
                    </td>
                </tr>`;
        });

    } catch (err) {
        console.error("Failed to load admins:", err);
        showToast("Failed to load admins", "error");
    }
}

// ========================================
// ADD USER/ADMIN FORMS
// ========================================
document.getElementById("addUserForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const userData = {
        firstName: document.getElementById("userFirstName").value.trim(),
        lastName: document.getElementById("userLastName").value.trim(),
        email: document.getElementById("userEmail").value.trim(),
        password: document.getElementById("userPassword").value.trim(),
        phone: document.getElementById("userPhone").value.trim(),
        userType: "customer"
    };

    try {
        const res = await fetch(API + "/admin/users", {
            method: "POST",
            headers: authHeaders(),
            body: JSON.stringify(userData)
        });

        const data = await res.json();

        if (data.success) {
            showToast("Customer added successfully", "success");
            closeModal("addUserModal");
            document.getElementById("addUserForm").reset();
            loadUsers();
            loadDashboardStats();
        } else {
            showToast(data.message || "Failed to add customer", "error");
        }

    } catch (err) {
        console.error("Failed to add user:", err);
        showToast("Failed to add customer", "error");
    }
});

document.getElementById("addAdminForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const adminData = {
        firstName: document.getElementById("adminFirstName").value.trim(),
        lastName: document.getElementById("adminLastName").value.trim(),
        email: document.getElementById("adminEmail").value.trim(),
        password: document.getElementById("adminPassword").value.trim(),
        userType: "admin"
    };

    try {
        const res = await fetch(API + "/admin/users", {
            method: "POST",
            headers: authHeaders(),
            body: JSON.stringify(adminData)
        });

        const data = await res.json();

        if (data.success) {
            showToast("Admin added successfully", "success");
            closeModal("addAdminModal");
            document.getElementById("addAdminForm").reset();
            loadAdmins();
            loadDashboardStats();
        } else {
            showToast(data.message || "Failed to add admin", "error");
        }

    } catch (err) {
        console.error("Failed to add admin:", err);
        showToast("Failed to add admin", "error");
    }
});

// ========================================
// UI CONTROLS
// ========================================
function showSection(sectionId, element) {
    // Hide all sections
    document.querySelectorAll('.section').forEach(sec =>
        sec.classList.remove('active')
    );

    // Show selected section
    document.getElementById(sectionId).classList.add('active');

    // Update sidebar active state
    if (element) {
        document.querySelectorAll('.nav-item').forEach(nav =>
            nav.classList.remove('active')
        );
        element.classList.add('active');
    }

    // Update header title
    const titles = {
        dashboard: 'Dashboard Overview',
        bookings: 'Bookings Management',
        users: 'Customer Management',
        admins: 'Admin Management'
    };
    document.querySelector('.header-title').innerText = titles[sectionId] || 'Dashboard';

    // Load data for the section
    if (sectionId === "bookings") loadBookings();
    if (sectionId === "users") loadUsers();
    if (sectionId === "admins") loadAdmins();

    // Close mobile sidebar
    if (window.innerWidth < 900) {
        document.getElementById("sidebar").classList.remove("active");
    }
}

function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
}

function logout() {
    if (confirm("Are you sure you want to log out?")) {
        localStorage.removeItem("fastsewa_token");
        localStorage.removeItem("fastsewa_current_user");
        window.location.href = "/login.html";
    }
}

function openAddUserModal() {
    document.getElementById("addUserModal").classList.add("active");
}

function openAddAdminModal() {
    document.getElementById("addAdminModal").classList.add("active");
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove("active");
}

function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        month: 'short',
        day: 'numeric'
    });
    document.getElementById("currentTime").innerText = timeStr;
}

// ========================================
// TOAST NOTIFICATIONS
// ========================================
function showToast(message, type = "success") {
    let toast = document.getElementById("admin-toast");

    if (!toast) {
        toast = document.createElement("div");
        toast.id = "admin-toast";
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-20px);
        `;
        document.body.appendChild(toast);
    }

    const colors = {
        success: "#22c55e",
        error: "#ef4444",
        info: "#3b82f6"
    };

    toast.style.background = colors[type] || colors.info;
    toast.innerText = message;
    toast.style.opacity = "1";
    toast.style.transform = "translateY(0)";

    setTimeout(() => {
        toast.style.opacity = "0";
        toast.style.transform = "translateY(-20px)";
    }, 3000);
}

// Close modals on outside click
window.addEventListener("click", (e) => {
    if (e.target.classList.contains("modal")) {
        e.target.classList.remove("active");
    }
});

auth.js --> 
const API_CONFIG = {
    BASE_URL: 'http://127.0.0.1:5000/api',
    // BASE_URL: 'https://fastsewawebsite.onrender.com/api',
    ENDPOINTS: {
        REGISTER: '/auth/register',
        LOGIN: '/auth/login',
        LOGOUT: '/auth/logout',
        GET_ME: '/auth/me',
        UPDATE_PROFILE: '/auth/update',
        CHANGE_PASSWORD: '/auth/change-password',
        SERVICES: '/services',
        DASHBOARD_STATS: '/services/dashboard/stats'
    }
};

class User {
    constructor(data) {
        this.id = data._id || data.id;
        this.firstName = data.firstName;
        this.lastName = data.lastName;
        this.fullName = data.fullName || `${data.firstName} ${data.lastName}`;
        this.email = data.email;
        this.phone = data.phone || '';
        this.address = data.address || '';
        this.userType = data.userType || 'customer';
        this.profilePic = data.profilePic;
        this.walletBalance = data.walletBalance || 0;
        this.totalServices = data.totalServices || 0;
        this.rating = data.rating || 0;
        this.activeBookings = data.activeBookings || 0;
        this.createdAt = data.createdAt || data.date || new Date().toISOString();
    }
}

class FastSewaAuth {
    constructor() {
        this.currentUser = null;
        this.token = localStorage.getItem('fastsewa_token') || null;
        this.init();
    }

    async init() {
        const savedUser = localStorage.getItem('fastsewa_current_user');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
        }
    }

    async apiRequest(endpoint, method = 'GET', data = null) {
        const url = `${API_CONFIG.BASE_URL}${endpoint}`;
        const headers = { 'Content-Type': 'application/json' };
        if (this.token) { headers['Authorization'] = `Bearer ${this.token}`; }

        const config = { method, headers };
        if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
            config.body = JSON.stringify(data);
        }

        try {
            const response = await fetch(url, config);
            const responseData = await response.json();
            if (!response.ok) {
                if (response.status === 401) { this.clearAuth(); }
                throw new Error(responseData.message || 'API request failed');
            }
            return responseData;
        } catch (error) {
            console.error('API Request Error:', error);
            throw error;
        }
    }

    saveToken(token) {
        this.token = token;
        localStorage.setItem('fastsewa_token', token);
    }

    clearAuth() {
        this.currentUser = null;
        this.token = null;
        localStorage.removeItem('fastsewa_token');
        localStorage.removeItem('fastsewa_current_user');
    }

    async signup(firstName, lastName, email, password, userType) {
        try {
            const response = await this.apiRequest(API_CONFIG.ENDPOINTS.REGISTER, 'POST', { firstName, lastName, email, password, userType });
            if (response.success) {
                this.saveToken(response.token);
                this.currentUser = new User(response.user);
                localStorage.setItem('fastsewa_current_user', JSON.stringify(this.currentUser));
                return { success: true, user: response.user };
            }
            return { success: false, message: response.message };
        } catch (error) {
            return { success: false, message: error.message || 'Registration failed.' };
        }
    }

    async login(email, password) {
        try {
            const response = await this.apiRequest(API_CONFIG.ENDPOINTS.LOGIN, 'POST', { email, password });
            if (response.success) {
                this.saveToken(response.token);

                // fetch fresh user from DB
                const me = await this.apiRequest('/auth/me');

                this.currentUser = new User(me.user);
                localStorage.setItem(
                    'fastsewa_current_user',
                    JSON.stringify(this.currentUser)
                );

                return { success: true, user: response.user };
            }
            return { success: false, message: response.message };
        } catch (error) {
            return { success: false, message: error.message || 'Login failed.' };
        }
    }

    async logout() {
        this.clearAuth();
        return { success: true };
    }


    async getCurrentUser() {
        if (!this.token) return null;
        try {
            const response = await this.apiRequest(API_CONFIG.ENDPOINTS.GET_ME);
            if (response.success) {
                this.currentUser = new User(response.user);
                localStorage.setItem('fastsewa_current_user', JSON.stringify(this.currentUser));
                return this.currentUser;
            }
            this.clearAuth();
            return null;
        } catch (error) {
            this.clearAuth();
            return null;
        }
    }

    isLoggedIn() {
        return !!this.token;
    }
}

// --- UTILITY: RESTORE FORM DATA ---
function checkAndFillPendingForm() {
    const savedData = localStorage.getItem('pending_booking');
    if (!savedData || !fastsewaAuth.isLoggedIn()) return;

    const { formData } = JSON.parse(savedData);
    if (!formData) return;

    Object.keys(formData).forEach(key => {
        const el = document.getElementById(key);
        if (el) el.value = formData[key];
    });
}

async function performLogout() {
    try { await fastsewaAuth.logout(); }
    finally { window.location.replace('/index.html'); }
}

const fastsewaAuth = new FastSewaAuth();

// --- LOGIN PAGE HANDLER ---
function initLogin() {
    const loginForm = document.getElementById('loginForm');
    if (!loginForm) return;

    loginForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value.trim();
        const loginBtn = document.getElementById('loginBtn');

        try {
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            const result = await fastsewaAuth.login(email, password);

            if (result.success) {
                showToast('Login successful!', 'success');

                setTimeout(() => {
                    const user =
                        fastsewaAuth.currentUser ||
                        JSON.parse(localStorage.getItem("fastsewa_current_user"));

                    const pending = localStorage.getItem("pending_booking");
                    const forcedRedirect = localStorage.getItem("auth_redirect");

                    // 1️⃣ Booking resume
                    if (pending) {
                        const { redirectTo } = JSON.parse(pending);
                        window.location.href = redirectTo.startsWith("/")
                            ? redirectTo
                            : "/" + redirectTo;
                        return;
                    }

                    // 2️⃣ Guard redirect
                    if (forcedRedirect) {
                        localStorage.removeItem("auth_redirect");
                        window.location.href = forcedRedirect;
                        return;
                    }

                    // 3️⃣ Role-based redirect
                    if (user?.userType === "admin") {
                        window.location.href = "/admin/dashboard.html";
                    } else {
                        window.location.href = "/dashboard.html";
                    }
                }, 500);
            } else {
                // Login failed - show error message
                showToast(result.message || 'Invalid email or password', 'error');
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }

        } catch (error) {
            showToast(error.message || 'Network error. Please try again.', 'error');
            loginBtn.disabled = false;
            loginBtn.textContent = 'Login';
        }
    });
}

// Global Toast function - appears from top center
function showToast(message, type = "success", duration = 3000) {
    let toast = document.getElementById("fastsewa-toast");

    if (!toast) {
        toast = document.createElement("div");
        toast.id = "fastsewa-toast";
        document.body.appendChild(toast);
    }

    toast.className = `fs-${type}`;
    toast.innerHTML = `
        <div class="fs-toast-icon">
            ${type === "success" ? "✔" : type === "error" ? "✖" : "ℹ"}
        </div>
        <div class="fs-toast-message">${message}</div>
        <div class="fs-progress"></div>
    `;

    // Trigger bounce animation
    setTimeout(() => {
        toast.classList.add("show");
    }, 10);

    // Auto hide
    setTimeout(() => {
        toast.classList.remove("show");
    }, duration);
}



// --- INITIALIZATION ON LOAD ---
document.addEventListener('DOMContentLoaded', function () {
    // 1. Check if we need to fill the form
    checkAndFillPendingForm();
    // 2. Initialize page specific logic
    if (window.location.pathname.includes('login.html')) {
        initLogin();
    }

    // 3. Global Logout listeners
    document.addEventListener('click', function (e) {
        const logoutLink = e.target.closest('#logoutBtn, #sidebarLogoutBtn');
        if (logoutLink) {
            e.preventDefault();
            performLogout();
        }
    });
});

window.fastsewaAuth = fastsewaAuth;

server.js --> 
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const bodyParser = require('body-parser');
require('dotenv').config();

const app = express();

// 1. Middleware
// CORS for hosted frontend
app.use(cors({
    origin: '*', // This allows requests from ANY website (local or hosted)
    methods: ['GET', 'POST', 'PUT', 'DELETE']
}));

app.use(bodyParser.json());

// MongoDB connection For LocalHost
mongoose.connect('mongodb://127.0.0.1:27017/fastsewa')
    .then(() => console.log("MongoDB Connected Successfully"))
    .catch(err => console.error("MongoDB Connection Error:", err));

// MongoDB connection For Railway
// const mongoURI = process.env.MONGODB_URI;
// mongoose.connect(mongoURI)
//     .then(() => console.log("MongoDB Atlas Connected Successfully"))
//     .catch(err => console.error("MongoDB Connection Error:", err));


// ---User Register SCHEMA ---
const UserSchema = new mongoose.Schema({
    firstName: { type: String, required: true },
    lastName: { type: String, required: true },

    // derived / display fields
    fullName: { type: String },

    email: { type: String, required: true, unique: true },
    password: { type: String, required: true },

    phone: String,
    address: String,

    userType: { type: String, default: 'customer' },
    date: { type: Date, default: Date.now }
});


const User = mongoose.model('User', UserSchema);

// ---SIGNUP ROUTE ---
app.post('/api/auth/register', async (req, res) => {
    try {
        console.log("REQ BODY:", req.body);
        const { firstName, lastName, email, password, phone, userType } = req.body;

        // Validate required fields
        if (!firstName || !lastName || !email || !password) {
            return res.status(400).json({
                success: false,
                message: "Please fill in all required fields"
            });
        }

        // Check if user already exists
        const existingUser = await User.findOne({ email });
        if (existingUser) {
            return res.status(400).json({
                success: false,
                message: "Email already registered. Please login instead."
            });
        }

        const newUser = new User({
            firstName,
            lastName,
            fullName: `${firstName} ${lastName}`,
            email,
            password,
            phone,
            userType: userType || 'customer'
        });
        await newUser.save();

        // Send back success and a "fake" token for now (since you're using fastsewa_token)
        res.status(201).json({
            success: true,
            message: "Account created successfully!",
            token: "mock-jwt-token-" + newUser._id,
            user: {
                _id: newUser._id,
                firstName: newUser.firstName,
                lastName: newUser.lastName,
                fullName: newUser.fullName,
                email: newUser.email,
                phone: newUser.phone,
                userType: newUser.userType
            }
        });
    } catch (err) {
        console.error("SIGNUP ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Registration failed. Please try again."
        });
    }
});

// --- LOGIN ROUTE ---
app.post('/api/auth/login', async (req, res) => {
    try {
        const { email, password } = req.body;

        // Validate input
        if (!email || !password) {
            return res.status(400).json({
                success: false,
                message: "Please enter both email and password"
            });
        }

        // 1. Find user by email
        const user = await User.findOne({ email });
        if (!user) {
            return res.status(401).json({
                success: false,
                message: "Invalid email or password"
            });
        }

        // 2. Check password (Direct comparison for now, use bcrypt later!)
        if (user.password !== password) {
            return res.status(401).json({
                success: false,
                message: "Invalid email or password"
            });
        }

        // 3. Send success response
        res.json({
            success: true,
            message: "Login successful",
            token: "mock-jwt-token-" + user._id,
            user: {
                _id: user._id,
                firstName: user.firstName,
                lastName: user.lastName,
                fullName: user.fullName,
                email: user.email,
                phone: user.phone,
                address: user.address,
                userType: user.userType
            }
        });
    } catch (err) {
        console.error("LOGIN ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Login failed. Please try again."
        });
    }
});

// --- UPDATE USER PROFILE ---
app.put('/api/auth/update', async (req, res) => {
    try {
        const authHeader = req.headers.authorization;
        console.log("AUTH HEADER:", authHeader);

        if (!authHeader || !authHeader.startsWith("Bearer ")) {
            return res.status(401).json({
                success: false,
                message: "Unauthorized - Please login again"
            });
        }

        const token = authHeader.replace("Bearer ", "");
        const userId = token.replace("mock-jwt-token-", "");
        console.log("USER ID:", userId);


        if (!userId) {
            return res.status(401).json({
                success: false,
                message: "Invalid token - Please login again"
            });
        }

        const { fullName, phone, address } = req.body;
        console.log("UPDATE DATA:", { fullName, phone, address });

        const updatedUser = await User.findByIdAndUpdate(
            userId,
            {
                fullName,
                phone,
                address
            },
            { new: true }
        );
        console.log("UPDATED USER FROM DB:", updatedUser);

        if (!updatedUser) {
            return res.status(404).json({
                success: false,
                message: "User not found"
            });
        }

        res.json({
            success: true,
            message: "Profile updated successfully",
            user: {
                _id: updatedUser._id,
                fullName: updatedUser.fullName,
                email: updatedUser.email,
                phone: updatedUser.phone,
                address: updatedUser.address,
                userType: updatedUser.userType
            }
        });

    } catch (err) {
        console.error("Profile Update Error:", err);
        res.status(500).json({
            success: false,
            message: "Update failed. Please try again."
        });
    }
});


//--------Booking Schema-----------
const BookingSchema = new mongoose.Schema({
    category: {
        type: String,
        required: true,
        enum: ['construction', 'land', 'finance', 'legal', 'medical', 'gst', 'incometax', 'material', 'repair', 'security', 'trademark'] // Matches your folder structure
    },
    fullName: String,
    email: String,
    phone: String,
    txnId: String,
    message: String,
    monthlyIncome: Number,
    monthlyExpense: Number,
    serviceType: String, // Maps to goalType in form
    notes: String,       // Maps to additional details
    selectedDoc: String, // Medical Specific Fields
    bookDate: Date,
    timeSlot: String,
    date: { type: Date, default: Date.now },
    userId: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User', // This must match the name of your User model
        required: false // Set to false for now so old data doesn't break
    },
    status: {
        type: String,
        enum: ['pending', 'verified', 'assigned', 'completed', 'cancelled'],
        default: 'pending'
    }
});

const Booking = mongoose.model('Booking', BookingSchema);

// 3. API Routes to save data (from the frontend form)
app.post('/api/bookings', async (req, res) => {
    try {
        const authHeader = req.headers.authorization;

        if (!authHeader || !authHeader.startsWith("Bearer ")) {
            return res.status(401).json({
                success: false,
                message: "Unauthorized - Please login to book a service"
            });
        }

        const token = authHeader.replace("Bearer ", "");
        const userId = token.replace("mock-jwt-token-", "");

        const bookingData = {
            ...req.body,
            userId
        };

        const newBooking = new Booking(bookingData);
        const savedBooking = await newBooking.save();

        res.status(201).json({
            success: true,
            message: "Booking created successfully",
            booking: savedBooking
        });

    } catch (err) {
        console.error("BOOKING SAVE ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Booking failed. Please try again."
        });
    }
});

// 4. Route to get all data (for Admin Dashboard)
app.get('/api/admin/bookings', async (req, res) => {
    try {
        const bookings = await Booking.find().sort({ date: -1 });
        res.json({
            success: true,
            bookings
        });
    } catch (err) {
        console.error("GET BOOKINGS ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to fetch bookings"
        });
    }
});

// --- GET CURRENT LOGGED-IN USER ---
app.get('/api/auth/me', async (req, res) => {
    try {
        const authHeader = req.headers.authorization;

        if (!authHeader || !authHeader.startsWith("Bearer ")) {
            return res.status(401).json({
                success: false,
                message: "Unauthorized - Please login"
            });
        }

        const token = authHeader.replace("Bearer ", "");
        const userId = token.replace("mock-jwt-token-", "");

        const user = await User.findById(userId).select("-password");

        if (!user) {
            return res.status(404).json({
                success: false,
                message: "User not found"
            });
        }

        res.json({
            success: true,
            user
        });

    } catch (err) {
        console.error("GET ME ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to get user info"
        });
    }
});

// --- GET LOGGED-IN USER BOOKINGS ---
app.get('/api/bookings/my', async (req, res) => {
    try {
        const authHeader = req.headers.authorization;

        if (!authHeader || !authHeader.startsWith("Bearer ")) {
            return res.status(401).json({
                success: false,
                message: "Unauthorized - Please login"
            });
        }

        const token = authHeader.replace("Bearer ", "");
        const userId = token.replace("mock-jwt-token-", "");

        const bookings = await Booking.find({ userId })
            .sort({ date: -1 });

        res.json({
            success: true,
            bookings
        });

    } catch (err) {
        console.error("MY BOOKINGS ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to fetch your bookings"
        });
    }
});


async function requireAdmin(req, res, next) {
    try {
        const authHeader = req.headers.authorization;
        if (!authHeader || !authHeader.startsWith("Bearer ")) {
            return res.status(401).json({
                success: false,
                message: "Unauthorized - Admin access required"
            });
        }

        const token = authHeader.replace("Bearer ", "");
        const userId = token.replace("mock-jwt-token-", "");

        const user = await User.findById(userId);

        if (!user || user.userType !== "admin") {
            return res.status(403).json({
                success: false,
                message: "Forbidden - Admin access required"
            });
        }

        req.admin = user;
        next();
    } catch (err) {
        console.error("ADMIN CHECK ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Server error"
        });
    }
}



app.get('/api/admin/users', requireAdmin, async (req, res) => {
    try {
        const users = await User.find().select("-password").sort({ date: -1 });
        res.json({
            success: true,
            users
        });
    } catch (err) {
        console.error("GET USERS ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to fetch users"
        });
    }
});


app.post('/api/admin/users', requireAdmin, async (req, res) => {
    try {
        const { firstName, lastName, email, password, phone, userType } = req.body;

        const exists = await User.findOne({ email });
        if (exists) {
            return res.status(400).json({
                success: false,
                message: "User with this email already exists"
            });
        }

        const user = new User({
            firstName,
            lastName,
            fullName: `${firstName} ${lastName}`,
            email,
            password,
            phone,
            userType: userType || 'customer'
        });

        await user.save();

        res.json({
            success: true,
            message: "User created successfully"
        });
    } catch (err) {
        console.error("CREATE USER ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to create user"
        });
    }
});


app.delete('/api/admin/users/:id', requireAdmin, async (req, res) => {
    try {
        const deleted = await User.findByIdAndDelete(req.params.id);

        if (!deleted) {
            return res.status(404).json({
                success: false,
                message: "User not found"
            });
        }

        res.json({
            success: true,
            message: "User deleted successfully"
        });
    } catch (err) {
        console.error("DELETE USER ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to delete user"
        });
    }
});


app.put('/api/admin/bookings/:id', requireAdmin, async (req, res) => {
    try {
        const { status } = req.body;

        const updated = await Booking.findByIdAndUpdate(
            req.params.id,
            { status },
            { new: true }
        );

        if (!updated) {
            return res.status(404).json({
                success: false,
                message: "Booking not found"
            });
        }

        res.json({
            success: true,
            message: "Booking updated successfully",
            booking: updated
        });
    } catch (err) {
        console.error("UPDATE BOOKING ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to update booking"
        });
    }
});


app.delete('/api/admin/bookings/:id', requireAdmin, async (req, res) => {
    try {
        const deleted = await Booking.findByIdAndDelete(req.params.id);

        if (!deleted) {
            return res.status(404).json({
                success: false,
                message: "Booking not found"
            });
        }

        res.json({
            success: true,
            message: "Booking deleted successfully"
        });
    } catch (err) {
        console.error("DELETE BOOKING ERROR:", err);
        res.status(500).json({
            success: false,
            message: "Failed to delete booking"
        });
    }
});

// 5. PORT: Railway will provide a port via process.env.PORT
// Note: '0.0.0.0' is important for Railway's network binding
// const PORT = process.env.PORT || 5000;
// app.listen(PORT, '0.0.0.0', () => console.log(`Server running on port ${PORT}`));

const PORT = 5000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`)); 

booking.js -->
// Handles all service form submissions with authentication
const BOOKING_CONFIG = {
    API_URL: 'http://127.0.0.1:5000/api/bookings',
    // API_URL: 'https://fastsewawebsite.onrender.com/api/bookings', // Use this for production
};

// Service category mapping based on HTML file names
const SERVICE_CATEGORIES = {
    'newconstruction.html': 'construction',
    'finance.html': 'finance',
    'land.html': 'land',
    'legal.html': 'legal',
    'gst.html': 'gst',
    'incometax.html': 'incometax',
    'material.html': 'material',
    'medical.html': 'medical',
    'repair.html': 'repair',
    'security.html': 'security',
    'trademark.html': 'trademark'
};

/**
 * Get the current service category based on the page
 */
function getCurrentCategory() {
    const path = window.location.pathname;
    const filename = path.substring(path.lastIndexOf('/') + 1);
    return SERVICE_CATEGORIES[filename] || 'unknown';
}

/**
 * Save form data for post-login restoration
 */
function savePendingBooking(category, formData) {
    const redirectTo = window.location.pathname;
    localStorage.setItem('pending_booking', JSON.stringify({
        category,
        redirectTo,
        formData
    }));
}

/**
 * Restore form data after login
 */
function restorePendingBooking() {
    const pending = localStorage.getItem('pending_booking');
    if (!pending) return false;

    try {
        const { category, formData } = JSON.parse(pending);
        const currentCategory = getCurrentCategory();

        if (category !== currentCategory) return false;

        // Fill form fields
        Object.keys(formData).forEach(key => {
            const field = document.getElementById(key);
            if (field) {
                field.value = formData[key] || '';
            }
        });

        return true;
    } catch (error) {
        console.error('Error restoring form:', error);
        return false;
    }
}

/**
 * Extract form data from a form element
 */
function extractFormData(form) {
    const formData = {};
    const inputs = form.querySelectorAll('input, select, textarea');

    inputs.forEach(input => {
        if (!input.id) return;

        if (input.type === "checkbox") {
            formData[input.id] = input.checked;
        } else {
            formData[input.id] = input.value.trim();
        }
    });

    return formData;
}


/**
 * Submit booking to backend
 */
async function submitBooking(formData, category) {
    const token = localStorage.getItem('fastsewa_token');

    if (!token) {
        throw new Error('Authentication required');
    }

    const payload = {
    ...formData,
    serviceType: formData.serviceType || formData.goalType || null,
    category
};

    const response = await fetch(BOOKING_CONFIG.API_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(payload)
    });

    const data = await response.json();

    if (!response.ok) {
        throw new Error(data.message || 'Booking submission failed');
    }

    return data;
}

/**
 * Handle form submission
 */
async function handleFormSubmit(event, formId, buttonId) {
    event.preventDefault();

    const form = document.getElementById(formId);
    const button = document.getElementById(buttonId);
    const category = getCurrentCategory();

    if (!form) {
        console.error(`Form with ID "${formId}" not found`);
        return;
    }

    // Extract form data
    const formData = extractFormData(form);

    // Check authentication
    if (!window.fastsewaAuth.isLoggedIn()) {
        savePendingBooking(category, formData);

        const confirmLogin = confirm("You need to login to continue. Go to login page?");

        if (confirmLogin) {
            window.location.href = '/login.html';
        }

        return;
    }


    // Disable button and show loading state
    const originalText = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

    try {
        const result = await submitBooking(formData, category);

        // Success
        showToast(result.message || 'Booking submitted successfully!', 'success');

        // Clear pending booking
        localStorage.removeItem('pending_booking');

        // Reset form
        form.reset();

        // Optional: Redirect to dashboard after 2 seconds
        const confirmRedirect = confirm("Booking successful! Go to dashboard now?");

        if (confirmRedirect) {
            const user = JSON.parse(localStorage.getItem('fastsewa_current_user'));
            if (user?.userType === 'admin') {
                window.location.href = '/admin/dashboard.html';
            } else {
                window.location.href = '/dashboard.html';
            }
        }


    } catch (error) {
        console.error('Booking error:', error);
        showToast(error.message || 'Submission failed. Please try again.', 'error');
    } finally {
        // Re-enable button
        button.disabled = false;
        button.innerHTML = originalText;
    }
}

/**
 * Initialize booking handler for a specific form
 */
function initBookingForm(formId, buttonId) {
    const form = document.getElementById(formId);

    if (!form) {
        console.warn(`Form "${formId}" not found on this page`);
        return;
    }

    form.addEventListener('submit', (e) => handleFormSubmit(e, formId, buttonId));

    // Restore pending booking if exists
    restorePendingBooking();
}

/**
 * Auto-initialize common form IDs on page load
 */
document.addEventListener('DOMContentLoaded', function () {
    // Map of form IDs to submit button IDs
    const formConfigs = {
        'constForm': 'submitBtn',
        'financeForm': 'financeSubmit',
        'landForm': 'submitBtn',
        'legalForm': 'submitBtn',
        'gstForm': 'submitBtn',
        'itrForm': 'submitBtn',
        'materialForm': 'submitBtn',
        'medicalForm': 'submitBtn',
        'repairForm': 'submitBtn',
        'securityForm': 'submitBtn',
        'tmForm': 'submitBtn'
    };

    // Initialize all forms that exist on the page
    Object.keys(formConfigs).forEach(formId => {
        const buttonId = formConfigs[formId];
        initBookingForm(formId, buttonId);
    });

    // Special handlers for forms with custom submit functions
    initCustomHandlers();
});

/**
 * Handle medical form booking
 */
async function handleMedicalBooking() {
    const form = document.getElementById('medicalForm');
    const btn = document.querySelector('.btn-submit');
    const status = document.getElementById('bookingStatus');

    if (!form) return;

    // Basic Validation
    const phone = document.getElementById('phone').value;
    const fullName = document.getElementById('fullName').value;
    const bookDate = document.getElementById('bookDate').value;
    const deptSelect = document.getElementById('deptSelect').value;

    if (!phone || !fullName || !bookDate || !deptSelect) {
        alert("Please fill in all required fields (Name, Phone, Date, and Service).");
        return;
    }

    // Extract all form data
    const formData = extractFormData(form);
    formData.serviceType = document.getElementById('deptSelect').value;
    formData.timeSlot = document.getElementById('timeSlot').value;


    // Check authentication
    if (!window.fastsewaAuth.isLoggedIn()) {
        savePendingBooking('medical', formData);
        showToast('Please login to continue', 'info');
        setTimeout(() => {
            window.location.href = '/login.html';
        }, 1000);
        return;
    }

    // UI Loading State
    const originalBtnText = btn.innerHTML;
    btn.innerHTML = "<i class='fas fa-circle-notch fa-spin'></i> Securing Token...";
    btn.style.opacity = "0.7";
    btn.disabled = true;

    try {
        const result = await submitBooking(formData, 'medical');

        // Success State
        btn.innerHTML = "<i class='fas fa-check-circle'></i> Request Confirmed";
        btn.classList.add('confirmed');
        btn.style.opacity = "1";
        if (status) {
            status.style.color = "var(--primary)";
            status.innerHTML = "Booking confirmed! Redirecting to dashboard...";
        }

        showToast('Medical appointment booked successfully!', 'success');
        localStorage.removeItem('pending_booking');

        // Reset form and redirect
        setTimeout(() => {
            form.reset();
            const user = JSON.parse(localStorage.getItem('fastsewa_current_user'));
            if (user?.userType === 'admin') {
                window.location.href = '/admin/dashboard.html';
            } else {
                window.location.href = '/dashboard.html';
            }
        }, 2000);

    } catch (error) {
        console.error("Booking Error:", error);
        btn.innerHTML = "<i class='fas fa-paper-plane'></i> Try Again";
        btn.style.opacity = "1";
        btn.disabled = false;
        if (status) {
            status.style.color = "#ef4444";
            status.innerHTML = "Connection Error. Please try again.";
        }
        showToast(error.message || 'Booking failed. Please try again.', 'error');
    }
}

/**
 * Handle repair form booking
 */
async function handleRepairBooking() {
    const form = document.getElementById('repairForm');
    const btn = document.querySelector('.btn-confirm');

    if (!form) return;

    // Map repair form fields to booking schema
    const formData = {
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        bookDate: document.getElementById('date').value,
        serviceType: document.getElementById('finalService').value,
        message: document.getElementById('message').value,
        notes: document.getElementById('urgentCheck')?.checked ? "URGENT REQUEST" : "Standard Request"
    };

    // Basic Validation
    if (!formData.fullName || !formData.phone || !formData.bookDate) {
        alert("Please fill in your Name, Phone, and Preferred Date.");
        return;
    }

    // Check authentication
    if (!window.fastsewaAuth.isLoggedIn()) {
        savePendingBooking('repair', formData);
        showToast('Please login to continue', 'info');
        setTimeout(() => {
            window.location.href = '/login.html';
        }, 1000);
        return;
    }

    // UI Loading
    btn.innerText = "Sending Request...";
    btn.disabled = true;

    try {
        await submitBooking(formData, 'repair');

        btn.innerText = "Booking Confirmed";
        btn.style.background = "#10b981";

        const isUrgent = document.getElementById('urgentCheck')?.checked;
        const timeStr = isUrgent ? "WITHIN 60 MINS" : "scheduled time";
        const msg = document.getElementById('successMsg');
        if (msg) {
            msg.innerHTML = `<i class="fas fa-check-circle"></i> Request saved! Technician arriving at ${timeStr}.`;
        }

        showToast('Repair booking confirmed!', 'success');
        localStorage.removeItem('pending_booking');

        setTimeout(() => {
            form.reset();
            window.location.href = '/dashboard.html';
        }, 2000);

    } catch (error) {
        console.error('Error:', error);
        btn.innerText = "Error - Try Again";
        btn.disabled = false;
        btn.style.background = "#ef4444";
        showToast(error.message || 'Booking failed. Please try again.', 'error');
    }
}

/**
 * Initialize custom handlers for special cases
 */
function initCustomHandlers() {
    // Medical form - override bookAppointment function
    const medicalForm = document.getElementById('medicalForm');
    if (medicalForm) {
        // Replace the global bookAppointment function
        window.bookAppointment = handleMedicalBooking;
    }

    // Repair form - override confirmBooking function
    const repairForm = document.getElementById('repairForm');
    if (repairForm) {
        // Replace the global confirmBooking function
        window.confirmBooking = handleRepairBooking;
    }
}

// Export for global use
window.FastSewaBooking = {
    submitBooking,
    handleFormSubmit,
    initBookingForm,
    getCurrentCategory,
    restorePendingBooking
};

check all these codes, admin dashboard is not working 