<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastSewa Repair | Expert Home Maintenance</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="./css/repair.css">
    <script src="../js/auth.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="../index.html">
                    <img src="../images/logo1.png" alt="FS" class="logo-img">
                    <div class="logo-text">Fast<span>Sewa</span></div>
                </a>
            </div>

            <ul class="nav-links" id="nav-menu">
                <li><a href="../index.html" class="nav-item">Home</a></li>
                <li><a href="../index.html#services" class="nav-item">Services</a></li>
                <li><a href="../index.html#contact" class="nav-item">Contact</a></li>
                <li><a href="../about.html" class="nav-item">About</a></li>
                <li id="auth-action">
                    <a href="../login.html" class="btn-nav">Login/Signup</a>
                </li>
            </ul>

            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <header class="repair-hero">
        <div class="hero-content">
            <h1>Expert Home Repairs</h1>
            <p>From quick fixes to smart home upgrades. Fast, Reliable & Verified Professionals.</p>
            <a href="#book-repair" class="btn-hero">Book a Service</a>
        </div>
    </header>

    <section class="category-section">
        <div class="cat-grid">
            <div class="cat-card" onclick="selectCategory('Electrical')">
                <div class="cat-icon"><i class="fas fa-bolt"></i></div>
                <div class="cat-name">Electrical</div>
            </div>
            <div class="cat-card" onclick="selectCategory('Plumbing')">
                <div class="cat-icon"><i class="fas fa-faucet"></i></div>
                <div class="cat-name">Plumbing</div>
            </div>
            <div class="cat-card" onclick="selectCategory('AC Repair')">
                <div class="cat-icon"><i class="fas fa-snowflake"></i></div>
                <div class="cat-name">AC Repair</div>
            </div>
            <div class="cat-card" onclick="selectCategory('Carpentry')">
                <div class="cat-icon"><i class="fa-solid fa-hammer"></i></div>
                <div class="cat-name">Carpentry</div>
            </div>
        </div>
    </section>

    <section id="estimator" class="estimator-section">
        <div class="container">
            <div class="estimator-box">
                <div class="est-left">
                    <h2>Live Rate Card</h2>
                    <p>Select your job and quantity to see the estimated cost.</p>
                    <div class="est-controls">
                        <label style="display:block; font-weight:600; margin-bottom:10px;">Select Job</label>
                        <select id="estService" onchange="calculateTotal()"
                            style="width:100%; padding:12px; border-radius:8px; border:2px solid #e2e8f0;">
                            <option value="0" disabled selected>Choose a specific job...</option>
                            <option value="199">General Inspection (₹199)</option>
                            <option value="450">Switch/Socket Repair (₹450)</option>
                            <option value="800">Tap/Faucet Install (₹800)</option>
                            <option value="1200">AC Deep Cleaning (₹1200)</option>
                        </select>
                        <label style="display:block; font-weight:600; margin-top:20px;">Quantity / Units</label>
                        <div class="qty-control">
                            <button onclick="changeQty(-1)">-</button>
                            <span id="qtyDisplay">1</span>
                            <button onclick="changeQty(1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="est-right">
                    <div class="price-display">
                        <small>Total Estimate</small>
                        <h3 id="totalPrice" style="font-size:3.5rem; margin:10px 0;">₹0</h3>
                        <p style="font-size:0.8rem; opacity:0.8; margin-bottom:20px;">+ Material costs if applicable</p>
                        <button class="btn-book-est" onclick="transferToBooking()">Transfer to Form</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="book-repair" class="booking-section">
        <div class="booking-container">
            <div class="info-side">
                <div class="trust-box" style="background:#fff7ed; padding:30px; border-radius:16px;">
                    <h3 style="color:#ea580c; margin-bottom: 20px;">Why FastSewa Repair?</h3>
                    <div style="display:flex; gap:15px; margin-bottom:20px;">
                        <i class="fas fa-user-shield" style="color:#ea580c; font-size:1.5rem;"></i>
                        <div>
                            <h4 style="margin:0;">Verified Pros</h4>
                            <p style="margin:0; font-size:0.9rem; color:#666;">Background checked experts.</p>
                        </div>
                    </div>
                    <div style="display:flex; gap:15px;">
                        <i class="fas fa-tools" style="color:#ea580c; font-size:1.5rem;"></i>
                        <div>
                            <h4 style="margin:0;">30 Days Warranty</h4>
                            <p style="margin:0; font-size:0.9rem; color:#666;">Service guaranteed.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-side">
                <div class="booking-form-card">
                    <form id="repairForm">
                        <input type="text" id="fullName" class="form-input" required placeholder="Full Name">
                        <div style="display: flex; gap: 15px;">
                            <input type="tel" id="phone" class="form-input" required placeholder="Phone Number">
                            <input type="date" id="date" class="form-input" required>
                        </div>
                        <input type="text" id="finalService" class="form-input" placeholder="Service Details" readonly>
                        <div class="urgent-toggle">
                            <input type="checkbox" id="urgentCheck" style="width:20px; height:20px;">
                            <label for="urgentCheck">Urgent: Need within 60 mins (+₹100)</label>
                        </div>
                        <textarea id="message" class="form-textarea" rows="3"
                            placeholder="Describe the issue..."></textarea>
                        <button type="button" class="btn-confirm" onclick="confirmBooking()">Confirm Booking</button>
                        <div id="successMsg"
                            style="text-align:center; margin-top:15px; font-weight:600; color:#10b981;"></div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        // --- 1. LIVE COST ESTIMATOR LOGIC ---
        let basePrice = 0;
        let quantity = 1;

        function calculateTotal() {
            const serviceSelect = document.getElementById('estService');
            basePrice = parseInt(serviceSelect.value);
            let total = basePrice * quantity;
            document.getElementById('totalPrice').innerText = "₹" + total;
        }

        function changeQty(amount) {
            quantity += amount;
            if (quantity < 1) quantity = 1;
            document.getElementById('qtyDisplay').innerText = quantity;
            if (basePrice > 0) calculateTotal();
        }

        function transferToBooking() {
            const serviceSelect = document.getElementById('estService');
            const selectedText = serviceSelect.options[serviceSelect.selectedIndex].text;
            if (serviceSelect.value == "0") {
                alert("Please select a service first!");
                return;
            }
            document.getElementById('book-repair').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('finalService').value = selectedText + " (Qty: " + quantity + ")";
        }

        function selectCategory(category) {
            document.getElementById('estimator').scrollIntoView({ behavior: 'smooth' });
            alert("You selected " + category + ". Please pick a job in the Rate Card.");
        }

        // --- 2. BOOKING CONFIRMATION LOGIC ---
        function confirmBooking() {
            const btn = document.querySelector('.btn-confirm');
            const msg = document.getElementById('successMsg');

            // Map your Repair form fields to your MongoDB Schema keys
            const formData = {
                category: 'repair', // Explicitly set based on your Schema enum
                fullName: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                bookDate: document.getElementById('date').value,
                serviceType: document.getElementById('finalService').value, // Maps to serviceType in Schema
                message: document.getElementById('message').value,
                notes: document.getElementById('urgentCheck').checked ? "URGENT REQUEST" : "Standard Request"
            };

            // Basic Validation
            if (!formData.fullName || !formData.phone || !formData.bookDate) {
                alert("Please fill in your Name, Phone, and Preferred Date.");
                return;
            }

            btn.innerText = "Sending Request...";
            btn.disabled = true;
        }
    </script>

    <script src="../js/script.js"></script>
    <script src="../js/booking.js"></script>
</body>

</html>